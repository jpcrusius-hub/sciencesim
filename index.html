<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulationen fÃ¼r den Unterricht</title>
    <meta name="robots" content="noindex, nofollow">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-size: 16px;
            line-height: 1.5;
            color: #1a1a1a;
            background: #fafafa;
            padding: 0 0 60px 0;
        }

        header {
            background: #fff;
            border-bottom: 1px solid #ddd;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .header-inner {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
        }

        h1 {
            font-size: 1.4em;
            font-weight: 600;
            color: #222;
            margin-bottom: 4px;
        }

        .subtitle {
            color: #666;
            font-size: 0.95em;
        }

        main {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .search-container {
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            max-width: 400px;
            padding: 10px 14px;
            font-size: 0.95em;
            border: 1px solid #ccc;
            background: #fff;
            font-family: inherit;
        }

        .search-input:focus {
            outline: none;
            border-color: #666;
        }

        .search-input::placeholder {
            color: #999;
        }

        #content {
            min-height: 200px;
        }

        .loading {
            color: #666;
            padding: 40px 0;
        }

        .fach {
            margin-bottom: 35px;
        }

        .fach-header {
            display: flex;
            align-items: baseline;
            gap: 12px;
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 2px solid;
        }

        .fach-physik .fach-header { border-color: #2c5aa0; }
        .fach-chemie .fach-header { border-color: #2a7a4b; }
        .fach-informatik .fach-header { border-color: #b35c00; }

        .fach-titel {
            font-size: 1.1em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .fach-physik .fach-titel { color: #2c5aa0; }
        .fach-chemie .fach-titel { color: #2a7a4b; }
        .fach-informatik .fach-titel { color: #b35c00; }

        .fach-count {
            font-size: 0.85em;
            color: #888;
        }

        .themengebiet {
            margin-bottom: 18px;
        }

        .thema-titel {
            font-size: 0.9em;
            font-weight: 600;
            color: #444;
            margin-bottom: 6px;
            padding-left: 2px;
        }

        .sim-liste {
            list-style: none;
        }

        .sim-eintrag {
            display: flex;
            align-items: baseline;
            flex-wrap: wrap;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .sim-eintrag:last-child {
            border-bottom: none;
        }

        .sim-link {
            color: #1a1a1a;
            text-decoration: none;
            flex: 1;
        }

        .sim-link:hover {
            color: #0066cc;
        }

        .sim-titel {
            font-weight: 500;
        }

        .sim-beschreibung {
            color: #666;
            font-size: 0.9em;
            margin-left: 8px;
        }

        .sim-meta {
            display: flex;
            gap: 15px;
            font-size: 0.85em;
            color: #888;
            margin-left: auto;
            padding-left: 15px;
            white-space: nowrap;
        }

        .sim-klasse {
            min-width: 50px;
        }

        .material-toggle {
            cursor: pointer;
            user-select: none;
            padding: 2px 4px;
        }

        .material-toggle:hover {
            background: #f0f0f0;
        }

        .material-dropdown {
            display: none;
            width: 100%;
            padding: 8px 0 4px 20px;
            font-size: 0.85em;
        }

        .material-dropdown.open {
            display: block;
        }

        .material-dropdown a {
            display: block;
            color: #555;
            text-decoration: none;
            padding: 3px 0;
        }

        .material-dropdown a:hover {
            color: #0066cc;
        }

        .qr-link {
            color: #888;
            text-decoration: none;
            font-size: 0.85em;
            padding: 2px 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            margin-left: 10px;
            cursor: pointer;
        }

        .qr-link:hover {
            background: #f0f0f0;
            border-color: #bbb;
        }

        footer {
            max-width: 900px;
            margin: 40px auto 0;
            padding: 20px;
            border-top: 1px solid #ddd;
            font-size: 0.85em;
            color: #888;
        }

        .lizenz {
            margin-bottom: 8px;
        }

        @media (max-width: 600px) {
            .sim-beschreibung {
                display: none;
            }
            .sim-meta {
                gap: 8px;
            }
            h1 {
                font-size: 1.2em;
            }
        }

        .keine-treffer {
            padding: 30px 0;
            color: #666;
            font-style: italic;
            display: none;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal.visible {
            display: flex;
        }

        .modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            position: relative;
            background: #fff;
            padding: 30px;
            max-width: 360px;
            width: 90%;
            text-align: center;
            border: 1px solid #ccc;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.8em;
            color: #888;
            cursor: pointer;
            line-height: 1;
        }

        .modal-close:hover {
            color: #333;
        }

        #qr-code-container {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        #qr-titel {
            font-size: 1.1em;
            font-weight: 600;
            margin: 0 0 4px 0;
            color: #222;
        }

        #qr-fach {
            font-size: 0.9em;
            color: #666;
            margin: 0 0 15px 0;
        }

        .qr-link-box {
            background: #f5f5f5;
            padding: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .qr-link-box code {
            font-size: 0.75em;
            color: #444;
            word-break: break-all;
            flex: 1;
            text-align: left;
        }

        .btn-copy {
            background: #fff;
            border: 1px solid #ccc;
            padding: 5px 10px;
            font-size: 0.8em;
            cursor: pointer;
            white-space: nowrap;
        }

        .btn-copy:hover {
            background: #f0f0f0;
        }

        .modal-actions {
            display: flex;
            justify-content: center;
        }

        .btn-print {
            background: #333;
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 0.95em;
            cursor: pointer;
        }

        .btn-print:hover {
            background: #555;
        }

        .print-only {
            display: none;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .print-only, .print-only * {
                visibility: visible;
            }
            .print-only {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #fff;
                padding: 40px;
                text-align: center;
            }
            #print-qr {
                display: flex;
                justify-content: center;
                margin-bottom: 25px;
            }
            #print-titel {
                font-size: 1.5em;
                font-weight: 600;
                margin: 0 0 10px 0;
            }
            #print-url {
                font-size: 1em;
                color: #444;
                font-family: monospace;
            }
        }
    </style>
</head>
<body>

<header>
    <div class="header-inner">
        <h1>Simulationen fÃ¼r den Unterricht</h1>
        <p class="subtitle">Interaktive Experimente fÃ¼r Physik, Chemie und Informatik</p>
    </div>
</header>

<main>
    <div class="search-container">
        <input 
            type="text" 
            class="search-input" 
            placeholder="Suchen... (z.B. Pendel, Dichte, Klasse 7)"
            id="suche"
        >
    </div>

    <div id="content">
        <p class="loading">Lade Simulationen...</p>
    </div>

    <p class="keine-treffer" id="keine-treffer">
        Keine Simulationen gefunden.
    </p>
</main>

<footer>
    <p class="lizenz">
        Nutzung nur fÃ¼r schulische und akademische Zwecke gestattet. 
        VerÃ¤nderung und kommerzielle Nutzung nicht erlaubt.
    </p>
</footer>

<!-- QR-Code Modal -->
<div id="qr-modal" class="modal">
    <div class="modal-backdrop" onclick="closeQR()"></div>
    <div class="modal-content">
        <button class="modal-close" onclick="closeQR()">&times;</button>
        <div id="qr-code-container"></div>
        <h3 id="qr-titel"></h3>
        <p id="qr-fach"></p>
        <div class="qr-link-box">
            <code id="qr-url"></code>
            <button onclick="copyLink()" class="btn-copy">Kopieren</button>
        </div>
        <div class="modal-actions">
            <button onclick="printQR()" class="btn-print">Drucken / Als PDF</button>
        </div>
    </div>
</div>

<!-- Druck-Ansicht -->
<div id="print-container" class="print-only">
    <div id="print-qr"></div>
    <h2 id="print-titel"></h2>
    <p id="print-url"></p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
const BASE_URL = window.location.origin + window.location.pathname.replace(/index\.html$/, '');
let alleSimulationen = [];

// Daten laden und Seite aufbauen
async function init() {
    try {
        const response = await fetch('simulations.json');
        if (!response.ok) throw new Error('Datei nicht gefunden');
        const data = await response.json();
        alleSimulationen = data.simulationen || [];
        renderContent(alleSimulationen);
    } catch (error) {
        document.getElementById('content').innerHTML = `
            <p style="color: #666;">Keine Simulationen gefunden. 
            FÃ¼ge Simulationen in Unterordner hinzu und warte auf den nÃ¤chsten Build.</p>
        `;
    }
}

// Inhalte rendern
function renderContent(simulationen) {
    const content = document.getElementById('content');
    
    if (simulationen.length === 0) {
        content.innerHTML = '<p style="color: #666;">Noch keine Simulationen vorhanden.</p>';
        return;
    }
    
    // Nach Fach gruppieren
    const faecher = {};
    simulationen.forEach(sim => {
        const fach = sim.fach.toLowerCase();
        if (!faecher[fach]) {
            faecher[fach] = {};
        }
        const thema = sim.thema || 'Allgemein';
        if (!faecher[fach][thema]) {
            faecher[fach][thema] = [];
        }
        faecher[fach][thema].push(sim);
    });
    
    // HTML generieren
    let html = '';
    const fachReihenfolge = ['physik', 'chemie', 'informatik'];
    
    fachReihenfolge.forEach(fach => {
        if (!faecher[fach]) return;
        
        const themen = faecher[fach];
        const anzahl = Object.values(themen).flat().length;
        
        html += `<section class="fach fach-${fach}">`;
        html += `<div class="fach-header">`;
        html += `<span class="fach-titel">${fach.charAt(0).toUpperCase() + fach.slice(1)}</span>`;
        html += `<span class="fach-count">${anzahl} Simulation${anzahl !== 1 ? 'en' : ''}</span>`;
        html += `</div>`;
        
        Object.keys(themen).sort().forEach(thema => {
            html += `<div class="themengebiet">`;
            html += `<div class="thema-titel">${thema}</div>`;
            html += `<ul class="sim-liste">`;
            
            themen[thema].forEach((sim, idx) => {
                const stichworte = Array.isArray(sim.stichworte) ? sim.stichworte.join(' ') : sim.stichworte || '';
                const hatMaterial = sim.materialien && sim.materialien.length > 0;
                const fachThema = `${sim.fach} Â· ${sim.thema}`;
                const matId = `mat-${fach}-${thema}-${idx}`.replace(/\s+/g, '-');
                
                html += `<li class="sim-eintrag" data-stichworte="${stichworte}">`;
                html += `<a href="${sim.pfad}" class="sim-link">`;
                html += `<span class="sim-titel">${sim.titel}</span>`;
                if (sim.kurzbeschreibung) {
                    html += `<span class="sim-beschreibung">â€“ ${sim.kurzbeschreibung}</span>`;
                }
                html += `</a>`;
                html += `<span class="sim-meta">`;
                if (sim.klassenstufe) {
                    html += `<span class="sim-klasse">Kl. ${sim.klassenstufe}</span>`;
                }
                if (hatMaterial) {
                    html += `<span class="material-toggle" onclick="toggleMaterial('${matId}')">ðŸ“Ž</span>`;
                }
                html += `</span>`;
                html += `<span class="qr-link" onclick="openQR('${sim.pfad}', '${sim.titel}', '${fachThema}')">QR</span>`;
                
                // Material-Dropdown
                if (hatMaterial) {
                    html += `<div id="${matId}" class="material-dropdown">`;
                    sim.materialien.forEach(mat => {
                        html += `<a href="${sim.pfad}${mat.datei}">${mat.titel}</a>`;
                    });
                    html += `</div>`;
                }
                
                html += `</li>`;
            });
            
            html += `</ul></div>`;
        });
        
        html += `</section>`;
    });
    
    content.innerHTML = html;
}

// Suche
document.getElementById('suche').addEventListener('input', function(e) {
    const suchbegriff = e.target.value.toLowerCase().trim();
    
    if (!suchbegriff) {
        renderContent(alleSimulationen);
        document.getElementById('keine-treffer').style.display = 'none';
        return;
    }
    
    const gefiltert = alleSimulationen.filter(sim => {
        const suchtext = [
            sim.titel,
            sim.kurzbeschreibung,
            sim.fach,
            sim.thema,
            sim.klassenstufe,
            Array.isArray(sim.stichworte) ? sim.stichworte.join(' ') : sim.stichworte
        ].join(' ').toLowerCase();
        
        return suchtext.includes(suchbegriff);
    });
    
    renderContent(gefiltert);
    document.getElementById('keine-treffer').style.display = gefiltert.length === 0 ? 'block' : 'none';
});

// QR-Code Funktionen
function toggleMaterial(id) {
    const dropdown = document.getElementById(id);
    if (dropdown) {
        dropdown.classList.toggle('open');
    }
}

function openQR(pfad, titel, fach) {
    const modal = document.getElementById('qr-modal');
    const container = document.getElementById('qr-code-container');
    const fullUrl = BASE_URL + pfad;
    
    container.innerHTML = '';
    
    new QRCode(container, {
        text: fullUrl,
        width: 200,
        height: 200,
        colorDark: '#000000',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.M
    });
    
    document.getElementById('qr-titel').textContent = titel;
    document.getElementById('qr-fach').textContent = fach;
    document.getElementById('qr-url').textContent = fullUrl;
    document.getElementById('print-titel').textContent = titel;
    document.getElementById('print-url').textContent = fullUrl;
    
    modal.classList.add('visible');
    document.body.style.overflow = 'hidden';
}

function closeQR() {
    document.getElementById('qr-modal').classList.remove('visible');
    document.body.style.overflow = '';
}

function copyLink() {
    const url = document.getElementById('qr-url').textContent;
    navigator.clipboard.writeText(url).then(() => {
        const btn = document.querySelector('.btn-copy');
        const original = btn.textContent;
        btn.textContent = 'Kopiert!';
        setTimeout(() => btn.textContent = original, 1500);
    });
}

function printQR() {
    const printQR = document.getElementById('print-qr');
    printQR.innerHTML = '';
    new QRCode(printQR, {
        text: document.getElementById('qr-url').textContent,
        width: 300,
        height: 300,
        colorDark: '#000000',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.M
    });
    setTimeout(() => window.print(), 100);
}

document.addEventListener('keydown', (e) => { 
    if (e.key === 'Escape') closeQR(); 
});

// Start
init();
</script>

</body>
</html>
